<!DOCTYPE html>
<html>
	<head>
		
			<title>Getting Started</title>
		
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<link rel="icon" type="image/png" href="../../_static/icon.png"/>
		<link rel="stylesheet" href="../../_static/site.css" type="text/css" media="screen"/>
		
		<script src="../../_components/jquery/jquery.min.js"></script>
		<script src="../../_components/jquery-syntax/jquery.syntax.min.js"></script>
		
		<script src="../../_static/links.js"></script>
		
		<script type="text/javascript">
		//<![CDATA[
			jQuery(function($) {
				$.syntax();
			});
		//]]>
		</script>
	</head>

	<body>
		<header> › <a class="link" href="../../index.html">Project</a> › <a class="link" href="../index.html">Guides</a></header>
		
		<main>
			
	<h1>Getting Started</h1>
	
	<p>This guide shows you how to implement a basic client and server.</p>
<section id="installation"><h2>Installation</h2>
<p>Add the gem to your project:</p>
<pre><code class="language-bash">$ bundle add async-websocket
</code></pre>
</section><section id="overview-video"><h2>Overview Video</h2>
<figure class="youtube-wrapper">
	<iframe class="youtube-video" src="https://www.youtube.com/embed/aHop4Yyjs_o" frameborder="0" allowfullscreen></iframe>
</figure>
</section><section id="client-implementation"><h2>Client Implementation</h2>
<pre><code class="language-ruby">#!/usr/bin/env ruby

require 'async'
require 'async/io/stream'
require 'async/http/endpoint'
require 'async/websocket/client'

USER = ARGV.pop || &quot;anonymous&quot;
URL = ARGV.pop || &quot;http://localhost:7070&quot;

Async do |task|
	stdin = Async::IO::Stream.new(
		Async::IO::Generic.new($stdin)
	)
	
	endpoint = Async::HTTP::Endpoint.parse(URL)
	
	Async::WebSocket::Client.connect(endpoint) do |connection|
		input_task = task.async do
			while line = stdin.read_until(&quot;\n&quot;)
				connection.write({user: USER, text: line})
				connection.flush
			end
		end
		
		connection.write({
			user: USER,
			status: &quot;connected&quot;,
		})
		
		while message = connection.read
			puts message.inspect
		end
	ensure
		input_task&amp;.stop
	end
end
</code></pre>
</section><section id="force-http/1-connection"><h3>Force HTTP/1 Connection</h3>
<p>This forces the endpoint to connect using <code>HTTP/1.1</code>.</p>
<pre><code class="language-ruby">endpoint = Async::HTTP::Endpoint.parse(&quot;https://remote-server.com&quot;, alpn_protocols: Async::HTTP::Protocol::HTTP11.names)

Async::WebSocket::Client.connect(endpoint) do ...
</code></pre>
<p>You may want to use this if the server advertises <code>HTTP/2</code> but doesn't support <code>HTTP/2</code> for WebSocket connections.</p>
</section><section id="server-side-with-rack-&amp;-falcon"><h2>Server Side with Rack &amp; Falcon</h2>
<pre><code class="language-ruby">#!/usr/bin/env -S falcon serve --bind http://localhost:7070 --count 1 -c

require 'async/websocket/adapters/rack'
require 'set'

$connections = Set.new

run lambda {|env|
	Async::WebSocket::Adapters::Rack.open(env, protocols: ['ws']) do |connection|
		$connections &lt;&lt; connection
		
		while message = connection.read
			$connections.each do |connection|
				connection.write(message)
				connection.flush
			end
		end
	ensure
		$connections.delete(connection)
	end or [200, {}, [&quot;Hello World&quot;]]
}
</code></pre>
</section>
				
			<footer>Documentation generated by <a href="https://github.com/socketry/utopia-project">Utopia::Project</a>.</footer>
		</main>
	</body>
</html>